@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix v: <http://example.org/Vendas#> .

# Classe Musica
<#MusicaTriplesMap>
    rr:logicalTable [ rr:sqlQuery """
        SELECT m.artista as interprete, 
        m.lancamento as dataLancamento, 
        m.descricao as titulo,
        m.valor as preco,
        (SELECT e.gravadora FROM estudio e WHERE e.nome=m.produzidaPor) as gravadora
        FROM musica m
        """];
    rr:subjectMap [
        rr:template "musica/{titulo}";
        rr:class v:Musica;
    ];
    rr:predicateObjectMap [
        rr:predicate v:interprete;
        rr:objectMap [ rr:column "interprete" ];
    ];
    rr:predicateObjectMap [
        rr:predicate v:dataLancamento;
        rr:objectMap [ rr:column "dataLancamento" ];
    ];
    rr:predicateObjectMap [
        rr:predicate v:titulo;
        rr:objectMap [ rr:column "titulo" ];
    ];
    rr:predicateObjectMap [
        rr:predicate v:preco;
        rr:objectMap [ rr:column "preco" ];
    ];
    rr:predicateObjectMap [
        rr:predicate v:distribuidaPor;
        rr:objectMap [ 
            rr:parentTriplesMap <#GravadoraTriplesMap>;
            rr:joinCondition [
                rr:child "gravadora";
                rr:parent "gravadora";
            ];
        ];
    ].

# Classe Gravadora
<#GravadoraTriplesMap>
    rr:logicalTable [ rr:sqlQuery """
        SELECT DISTINCT e.gravadora
        FROM estudio e
        """];
    rr:subjectMap [
        rr:template "gravadora/{gravadora}";
        rr:class v:Gravadora;
    ];
    rr:predicateObjectMap [
        rr:predicate v:nomeGravadora;
        rr:objectMap [ rr:column "gravadora" ];
    ].

# Tabela Livro
<#LivroTriplesMap>
    rr:logicalTable [ rr:tableName "book" ];
    rr:subjectMap [
        rr:template "book/{title}";
        rr:class v:Book;
    ];
    rr:predicateObjectMap [
        rr:predicate v:title;
        rr:objectMap [ rr:column "title" ];
    ];
    rr:predicateObjectMap [
        rr:predicate v:pub;
        rr:objectMap [ 
            rr:parentTriplesMap <#PublTriplesMap>;
            rr:joinCondition [
                rr:child "publisher";
                rr:parent "name";
            ];
        ];
    ].
    
# Table publ
<#PublTriplesMap>
    rr:logicalTable [ rr:tableName "publ" ];
    rr:subjectMap [
        rr:template "publisher/{name}";
        rr:class v:Publ;
    ];
    rr:predicateObjectMap [
        rr:predicate v:name;
        rr:objectMap [ rr:column "name" ];
    ];
    rr:predicateObjectMap [
        rr:predicate v:address;
        rr:objectMap [ rr:column "address" ];
    ].